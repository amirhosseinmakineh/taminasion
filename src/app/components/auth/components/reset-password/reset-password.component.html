<app-layout-header></app-layout-header>

<section class="auth-section">
  <div class="container">
    <div class="image-section" aria-hidden="true"></div>
    <div class="form-section">
      <h2>تغییر رمز عبور</h2>
      <p>برای تکمیل فرآیند بازیابی، رمز عبور جدید خود را وارد کنید.</p>

      <app-feedback-message
        *ngIf="feedbackMessage"
        [type]="feedbackType"
        [message]="feedbackMessage"
        (closed)="clearFeedback()"
      ></app-feedback-message>

      <div class="status-message" *ngIf="isCheckingToken">
        در حال بررسی اعتبار توکن...
      </div>

      <form *ngIf="tokenIsValid" [formGroup]="resetPasswordForm" (ngSubmit)="submit()" novalidate>
        <div class="form-field" [class.invalid]="password?.invalid && password?.touched">
          <label for="password">رمز عبور جدید</label>
          <input id="password" type="password" formControlName="password" placeholder="********" required />
          <span class="error" *ngIf="password?.hasError('required') && password?.touched">رمز عبور الزامی است.</span>
          <span class="error" *ngIf="password?.hasError('minlength') && password?.touched">رمز عبور باید حداقل ۶ کاراکتر باشد.</span>
        </div>

        <div
          class="form-field"
          [class.invalid]="
            (confirmPassword?.invalid && confirmPassword?.touched) ||
            (resetPasswordForm.hasError('mismatch') && confirmPassword?.touched)
          "
        >
          <label for="confirmPassword">تکرار رمز عبور</label>
          <input id="confirmPassword" type="password" formControlName="confirmPassword" placeholder="********" required />
          <span class="error" *ngIf="confirmPassword?.hasError('required') && confirmPassword?.touched">تکرار رمز عبور الزامی است.</span>
          <span class="error" *ngIf="resetPasswordForm.hasError('mismatch') && confirmPassword?.touched"
            >رمزهای عبور یکسان نیستند.</span
          >
        </div>

        <button type="submit" [disabled]="!tokenIsValid || resetPasswordForm.invalid || isSubmitting">
          <span *ngIf="!isSubmitting">ثبت رمز عبور جدید</span>
          <span *ngIf="isSubmitting" class="loading">در حال ذخیره...</span>
        </button>
      </form>

      <div class="status-message" *ngIf="!tokenIsValid && !isCheckingToken">
        برای دریافت توکن جدید، دوباره درخواست بازیابی رمز عبور را ارسال کنید.
        <a routerLink="../forgot-password">ارسال دوباره ایمیل</a>
      </div>

      <div class="footer-text">
        بازگشت به
        <a routerLink="../login">صفحه ورود</a>
      </div>
    </div>
  </div>
</section>
