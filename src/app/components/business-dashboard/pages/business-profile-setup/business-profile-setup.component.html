<section class="setup-card">
  <div>
    <h2>تکمیل پروفایل کسب‌وکار</h2>
    <p class="muted">برای دسترسی به تب‌های داشبورد، اطلاعات زیر را تکمیل کنید.</p>
  </div>

  <form [formGroup]="profileForm" (ngSubmit)="submitProfile()" novalidate>
    <div class="form-grid">
      <label class="field">
        <span>عکس پروفایل</span>
        <div class="upload-box">
          <input type="file" (change)="onImageSelected($event)" />
          <p>{{ profileForm.get('imageName')?.value || 'فایل را انتخاب کنید' }}</p>
        </div>
        <small *ngIf="profileForm.get('imageName')?.touched && profileForm.get('imageName')?.invalid">این فیلد الزامی است.</small>
      </label>

      <label class="field">
        <span>نام خانوادگی</span>
        <input formControlName="family" placeholder="مثلاً احمدی" />
        <small *ngIf="profileForm.get('family')?.touched && profileForm.get('family')?.invalid">این فیلد الزامی است.</small>
      </label>

      <label class="field">
        <span>سن</span>
        <input type="number" formControlName="age" placeholder="سن مالک" />
        <small *ngIf="profileForm.get('age')?.touched && profileForm.get('age')?.invalid">این فیلد الزامی است.</small>
      </label>

      <label class="field" [formGroupName]="'city'">
        <span>شهر</span>
        <select formControlName="id" (change)="onCityChange($any($event.target)?.value)">
          <option value="" disabled>انتخاب کنید</option>
          <option *ngFor="let city of cities" [value]="city.id">{{ city.name }}</option>
        </select>
        <input type="hidden" formControlName="name" />
        <small *ngIf="profileForm.get('city')?.touched && profileForm.get('city')?.invalid">انتخاب شهر الزامی است.</small>
      </label>

      <label class="field" [formGroupName]="'region'">
        <span>منطقه</span>
        <select formControlName="id" (change)="onRegionChange($any($event.target)?.value)">
          <option value="" disabled>انتخاب کنید</option>
          <option *ngFor="let region of regions" [value]="region.id">{{ region.regionName }}</option>
        </select>
        <input type="hidden" formControlName="regionName" />
        <small *ngIf="profileForm.get('region')?.touched && profileForm.get('region')?.invalid">انتخاب منطقه الزامی است.</small>
      </label>

      <label class="field" [formGroupName]="'neighborhood'">
        <span>محله</span>
        <select formControlName="id" (change)="onNeighborhoodChange($any($event.target)?.value)">
          <option value="" disabled>انتخاب کنید</option>
          <option *ngFor="let neighborhood of neighborhoods" [value]="neighborhood.id">{{ neighborhood.neighborhoodName }}</option>
        </select>
        <input type="hidden" formControlName="neighborhoodName" />
        <small *ngIf="profileForm.get('neighborhood')?.touched && profileForm.get('neighborhood')?.invalid">انتخاب محله الزامی است.</small>
      </label>
    </div>

    <div class="section" [formGroupName]="'business'">
      <h3>اطلاعات کسب‌وکار</h3>
      <div class="form-grid">
        <label class="field">
          <span>لوگوی کسب‌وکار</span>
          <div class="upload-box">
            <input type="file" (change)="onLogoSelected($event)" />
            <p>{{ profileForm.get('business.businessLogo')?.value || 'فایل را انتخاب کنید' }}</p>
          </div>
          <small *ngIf="profileForm.get('business.businessLogo')?.touched && profileForm.get('business.businessLogo')?.invalid">
            این فیلد الزامی است.
          </small>
        </label>

        <label class="field">
          <span>نام کسب‌وکار</span>
          <input formControlName="businessName" placeholder="مثلاً سالن زیبایی آفتاب" />
          <small *ngIf="profileForm.get('business.businessName')?.touched && profileForm.get('business.businessName')?.invalid">این فیلد الزامی است.</small>
        </label>

        <label class="field">
          <span>مالک کسب‌وکار</span>
          <input formControlName="businessOwnerName" placeholder="نام مالک" />
          <small *ngIf="profileForm.get('business.businessOwnerName')?.touched && profileForm.get('business.businessOwnerName')?.invalid">این فیلد الزامی است.</small>
        </label>

        <label class="field">
          <span>میزان هزینه (میانگین خدمات)</span>
          <input type="number" formControlName="amount" placeholder="به تومان" />
          <small *ngIf="profileForm.get('business.amount')?.touched && profileForm.get('business.amount')?.invalid">این فیلد الزامی است.</small>
        </label>

        <label class="field">
          <span>امتیاز کاربران</span>
          <input type="number" formControlName="userRate" step="0.1" min="0" max="5" placeholder="0 تا 5" />
          <small *ngIf="profileForm.get('business.userRate')?.touched && profileForm.get('business.userRate')?.invalid">این فیلد الزامی است.</small>
        </label>

        <label class="field full-width">
          <span>توضیحات</span>
          <textarea formControlName="description" rows="3" placeholder="معرفی کوتاه کسب‌وکار"></textarea>
          <small *ngIf="profileForm.get('business.description')?.touched && profileForm.get('business.description')?.invalid">این فیلد الزامی است.</small>
        </label>

        <label class="field full-width">
          <span>افتخارات و دستاوردها (هر مورد در خط جدید یا جداشده با کاما)</span>
          <textarea
            rows="3"
            [value]="achievementText"
            (input)="updateAchievements($any($event.target).value)"
            placeholder="مثلاً برنده مسابقات آرایشگری"
          ></textarea>
          <small *ngIf="profileForm.get('business.achevmentNames')?.touched && profileForm.get('business.achevmentNames')?.invalid">این فیلد الزامی است.</small>
        </label>
      </div>
    </div>

    <div class="section">
      <h3>روزها و زمان‌های ارائه خدمات</h3>
      <div class="option-grid">
        <div class="option-group">
          <p>روزهای کاری</p>
          <div class="chip-list">
            <label *ngFor="let day of dayOptions" class="chip">
              <input type="checkbox" [checked]="profileForm.get('dayIds')?.value?.includes(day.id)" (change)="toggleSelection('dayIds', day.id)" />
              <span>{{ day.label }}</span>
            </label>
          </div>
          <small *ngIf="profileForm.get('dayIds')?.touched && profileForm.get('dayIds')?.invalid">حداقل یک روز را انتخاب کنید.</small>
        </div>

        <div class="option-group">
          <p>بازه‌های زمانی</p>
          <div class="chip-list">
            <label *ngFor="let time of timeOptions" class="chip">
              <input type="checkbox" [checked]="profileForm.get('timeIds')?.value?.includes(time.id)" (change)="toggleSelection('timeIds', time.id)" />
              <span>{{ time.label }}</span>
            </label>
          </div>
          <small *ngIf="profileForm.get('timeIds')?.touched && profileForm.get('timeIds')?.invalid">حداقل یک بازه زمانی را انتخاب کنید.</small>
        </div>
      </div>
    </div>

    <button type="submit" [disabled]="submitting" class="primary-btn">
      {{ submitting ? 'در حال ثبت...' : 'ثبت و ادامه' }}
    </button>
  </form>
</section>
