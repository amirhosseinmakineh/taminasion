<div class="details-page" dir="rtl">
  <ng-container *ngIf="businessDetail as detail; else statusTemplate">
    <div class="cover">
      <ng-container *ngIf="getImageUrl(detail.bannerName) as bannerUrl; else fallbackBanner">
        <img [src]="bannerUrl" [alt]="detail.name">
      </ng-container>
      <ng-template #fallbackBanner>
        <div class="cover-fallback"></div>
      </ng-template>
      <div class="logo-box">
        <ng-container *ngIf="getImageUrl(detail.logo) as logoUrl; else fallbackLogo">
          <img [src]="logoUrl" [alt]="detail.name">
        </ng-container>
        <ng-template #fallbackLogo>{{ detail.name.charAt(0) || '?' }}</ng-template>
      </div>
    </div>

    <div class="container">
      <div class="card">
        <div class="info-header">
          <div class="title-group">
            <h1>{{ detail.name }}</h1>
            <p class="person-count" *ngIf="getServiceCountLabel(detail.businessServiceDtos) as serviceLabel">
              {{ serviceLabel }}
            </p>
          </div>
          <ng-container *ngIf="getAverageRating(detail.commentDtos) as rating; else noRating">
            <div class="rating">
              <span class="star">โ</span>
              <span class="score">{{ rating }}</span>
              <span class="votes" *ngIf="getReviewCount(detail.commentDtos) as voteCount">{{ voteCount }}</span>
            </div>
          </ng-container>
          <ng-template #noRating>
            <div class="rating muted">
              <span class="star">โ</span>
              <span class="score">ุจุฏูู ุงูุชุงุฒ</span>
            </div>
          </ng-template>
        </div>

        <div class="tabs">
          <button type="button" [class.active]="activeTab==='about'" (click)="setActiveTab('about')">ุฏุฑุจุงุฑู ูุง</button>
          <button type="button" [class.active]="activeTab==='staff'" (click)="setActiveTab('staff')">ูพุฑุณูู</button>
          <button type="button" [class.active]="activeTab==='info'" (click)="setActiveTab('info')">ุงุทูุงุนุงุช ุณุงูู</button>
          <button type="button" [class.active]="activeTab==='reviews'" (click)="setActiveTab('reviews')">ูุธุฑุงุช</button>
        </div>

        <section id="about" class="tab-content" [class.active]="activeTab==='about'">
          <div class="content-main">
            <ng-container *ngIf="detail.description; else noDescription">
              <p>{{ detail.description }}</p>
            </ng-container>
            <ng-template #noDescription>
              <p class="empty-state">ุชูุถุญุงุช ุจุฑุง ุงู ฺฉุณุจโูฺฉุงุฑ ุซุจุช ูุดุฏู ุงุณุช.</p>
            </ng-template>
          </div>
          <div class="achievements">
            <h3>ุฏุณุชุงูุฑุฏูุง</h3>
            <ng-container *ngIf="detail.achievementDtos?.length; else noAchievements">
              <div class="tags">
                <span
                  class="tag"
                  [ngClass]="getAchievementColor(index)"
                  *ngFor="let achievement of detail.achievementDtos; let index = index; trackBy: trackByAchievement"
                >
                  {{ achievement.name }}
                </span>
              </div>
            </ng-container>
            <ng-template #noAchievements>
              <p class="empty-state">ุงูุชุฎุงุฑ ุซุจุช ูุดุฏู ุงุณุช.</p>
            </ng-template>
          </div>
        </section>

        <section id="staff" class="tab-content" [class.active]="activeTab==='staff'">
          <div>
            <h3>ุฎุฏูุงุช ูุงุจู ุงุฑุงุฆู</h3>
            <ng-container *ngIf="detail.businessServiceDtos?.length; else noServices">
              <div class="service-list">
                <div class="service-item" *ngFor="let service of detail.businessServiceDtos; trackBy: trackByService">
                  <span class="service-name">{{ service.serviceName }}</span>
                  <span class="service-price">{{ formatPrice(service.amount) }}</span>
                </div>
              </div>
            </ng-container>
            <ng-template #noServices>
              <p class="empty-state">ุณุฑูุณ ุซุจุช ูุดุฏู ุงุณุช.</p>
            </ng-template>
          </div>
          <div class="staff-summary">
            <ng-container *ngIf="detail.businessOwnerDayDtos?.length; else noStaffSchedule">
              <ng-container *ngIf="getActiveDayCount(detail.businessOwnerDayDtos) as activeDays">
                <p *ngIf="activeDays; else noActiveSchedule">
                  ุงู ูุฌููุนู ุฏุฑ {{ activeDays.toLocaleString('fa-IR') }} ุฑูุฒ ุงุฒ ููุชู ูุนุงู ุงุณุช.
                </p>
                <ng-template #noActiveSchedule>
                  <p>ุฒูุงูโุจูุฏ ูุนุงู ุจุฑุง ูพุฑุณูู ุซุจุช ูุดุฏู ุงุณุช.</p>
                </ng-template>
              </ng-container>
            </ng-container>
            <ng-template #noStaffSchedule>
              <p>ุงุทูุงุนุงุช ุฏุฑุจุงุฑู ุฒูุงูโุจูุฏ ูพุฑุณูู ููุฌูุฏ ูุณุช.</p>
            </ng-template>
          </div>
        </section>

        <section id="info" class="tab-content" [class.active]="activeTab==='info'">
          <div>
            <h3>ุงุทูุงุนุงุช ุชูุงุณ ู ูููุนุช</h3>
            <p *ngIf="detail.cityName || detail.regionName || detail.neighberhoodName">
              ๐ ุขุฏุฑุณ: {{ detail.cityName }}<ng-container *ngIf="detail.regionName">ุ {{ detail.regionName }}</ng-container><ng-container *ngIf="detail.neighberhoodName">ุ {{ detail.neighberhoodName }}</ng-container>
            </p>
            <p *ngIf="!detail.cityName && !detail.regionName && !detail.neighberhoodName" class="empty-state">
              ุขุฏุฑุณ ุงู ฺฉุณุจโูฺฉุงุฑ ุซุจุช ูุดุฏู ุงุณุช.
            </p>
          </div>
          <div>
            <h3>ุณุงุนุงุช ฺฉุงุฑ</h3>
            <ng-container *ngIf="detail.businessOwnerDayDtos?.length; else noSchedule">
              <div class="schedule">
                <div class="schedule-row" *ngFor="let day of detail.businessOwnerDayDtos; trackBy: trackByDay">
                  <span class="day-name">{{ getDayName(day.dayOfWeek) }}</span>
                  <div class="day-times">
                    <ng-container *ngIf="day.businessOwnerTimes?.length; else closedDay">
                      <span
                        class="time-chip"
                        [class.reserved]="time.isReserved"
                        *ngFor="let time of day.businessOwnerTimes; trackBy: trackByTime"
                      >
                        {{ formatTime(time.from) }} - {{ formatTime(time.to) }}
                      </span>
                    </ng-container>
                    <ng-template #closedDay>
                      <span class="empty-state">ุฒูุงู ุซุจุช ูุดุฏู ุงุณุช.</span>
                    </ng-template>
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-template #noSchedule>
              <p class="empty-state">ุฒูุงูโุจูุฏ ุจุฑุง ุงู ฺฉุณุจโูฺฉุงุฑ ููุฌูุฏ ูุณุช.</p>
            </ng-template>
          </div>
        </section>

        <section id="reviews" class="tab-content" [class.active]="activeTab==='reviews'">
          <ng-container *ngIf="detail.commentDtos?.length; else noComments">
            <article class="comment" *ngFor="let comment of detail.commentDtos; trackBy: trackByComment">
              <header class="comment-header">
                <span class="comment-author">{{ comment.userFullName ?? 'ฺฉุงุฑุจุฑ' }}</span>
                <span class="comment-date" *ngIf="formatCommentDate(comment.createdOn) as date">{{ date }}</span>
              </header>
              <p class="comment-text">{{ getCommentText(comment) }}</p>
            </article>
          </ng-container>
          <ng-template #noComments>
            <p class="empty-state">ูุธุฑ ุจุฑุง ุงู ฺฉุณุจโูฺฉุงุฑ ุซุจุช ูุดุฏู ุงุณุช.</p>
          </ng-template>
        </section>
      </div>
    </div>
  </ng-container>

  <ng-template #statusTemplate>
    <div class="status" *ngIf="isLoading">ุฏุฑ ุญุงู ุจุงุฑฺฏุฐุงุฑ ุงุทูุงุนุงุช...</div>
    <div class="status error" *ngIf="!isLoading && errorMessage">{{ errorMessage }}</div>
  </ng-template>
</div>
