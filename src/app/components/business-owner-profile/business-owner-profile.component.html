<div class="profile-wrapper" [class.dark]="isDarkMode">
  <div class="container">
    <ng-container *ngIf="!loading; else loadingTpl">
      <ng-container *ngIf="profile; else errorTpl">
        <div class="card">
          <div class="header">
            <img class="header-img" [src]="bannerImage" alt="header" />
            <div class="header-buttons">
              <button type="button">پروفایل من</button>
              <button type="button" (click)="toggleTheme()">
                <span class="material-icons">{{ isDarkMode ? 'light_mode' : 'dark_mode' }}</span>
              </button>
            </div>
            <img class="profile-pic" [src]="profileImage" alt="پروفایل" />
          </div>

          <div class="content">
            <div class="header-info">
              <div>
                <h1>{{ profile.name }} {{ profile.family }}</h1>
                <p>{{ profile.businessInfo?.businessName || 'کسب‌وکار نامشخص' }}</p>
              </div>
              <div class="rating">
                <span>
                  {{ profile.businessInfo?.userRate != null ? (profile.businessInfo?.userRate | number: '1.0-1') : 'امتیاز ثبت نشده' }}
                  ({{ commentsCount }} نظر)
                </span>
                <span class="material-icons">star</span>
              </div>
            </div>

            <div class="tabs" role="tablist">
              <button
                *ngFor="let tab of tabs; trackBy: trackByTab"
                class="tab"
                type="button"
                role="tab"
                [attr.aria-selected]="activeTab === tab.id"
                [class.active]="activeTab === tab.id"
                (click)="setActiveTab(tab.id)"
              >
                {{ tab.label }}
              </button>
            </div>

            <div class="grid">
              <div class="bio">
                <ng-container *ngIf="bioParagraphs.length; else noBio">
                  <p *ngFor="let paragraph of bioParagraphs; trackBy: trackByParagraph">{{ paragraph }}</p>
                </ng-container>
              </div>
              <div class="tags">
                <h3>دستاوردها</h3>
                <ng-container *ngIf="achievements.length; else noAchievements">
                  <div class="tag-list">
                    <span class="tag" *ngFor="let achievement of achievements; trackBy: trackByAchievement">{{ achievement }}</span>
                  </div>
                </ng-container>
              </div>
            </div>
          </div>
        </div>
      </ng-container>
    </ng-container>
  </div>
</div>

<ng-template #loadingTpl>
  <div class="card status-card">
    <p>در حال بارگذاری...</p>
  </div>
</ng-template>

<ng-template #errorTpl>
  <div class="card status-card">
    <p>{{ error || 'اطلاعات پروفایل یافت نشد.' }}</p>
  </div>
</ng-template>

<ng-template #noBio>
  <p>توضیحاتی برای معرفی ثبت نشده است.</p>
</ng-template>

<ng-template #noAchievements>
  <p>دستاوردی ثبت نشده است.</p>
</ng-template>
