<app-layout-header></app-layout-header>

<div class="business-details-page">
  <div class="state" *ngIf="isLoading" i18n>ุฏุฑ ุญุงู ุจุงุฑฺฏุฐุงุฑ ุงุทูุงุนุงุช...</div>

  <div class="state error" *ngIf="!isLoading && errorMessage">{{ errorMessage }}</div>

  <ng-container *ngIf="!isLoading && !errorMessage && businessDetail as detail">
    <div class="cover">
      <img [src]="getBannerUrl(detail.bannerName)" [alt]="('ฺฉุงูุฑ ' + detail.name)" />
      <div class="logo-box">
        <ng-container *ngIf="getLogoUrl(detail.logo) as logoUrl; else logoInitial">
          <img [src]="logoUrl" [alt]="detail.name" />
        </ng-container>
        <ng-template #logoInitial>
          <span>{{ getInitial(detail.name) }}</span>
        </ng-template>
      </div>
    </div>

    <div class="container">
      <div class="card">
        <div class="info-header">
          <div>
            <h1>{{ detail.name }}</h1>
            <p class="person-count">
              {{ detail.cityName }}ุ {{ detail.regionName }}ุ {{ detail.neighberhoodName }}
            </p>
          </div>
          <div class="rating" *ngIf="averageRating !== null || ratingCount > 0">
            <span class="star" aria-hidden="true">โ</span>
            <span class="score">
              <ng-container *ngIf="averageRating !== null; else noRating">
                {{ averageRating | number: '1.1-1' }}
              </ng-container>
              <ng-template #noRating><span i18n>ุจุฏูู ุงูุชุงุฒ</span></ng-template>
            </span>
            <span class="votes">({{ ratingCount | number: '1.0-0' }})</span>
          </div>
        </div>

        <div class="tabs" role="tablist">
          <button type="button" [class.active]="activeTab === 'about'" (click)="setActiveTab('about')" i18n>
            ุฏุฑุจุงุฑู ูุง
          </button>
          <button type="button" [class.active]="activeTab === 'staff'" (click)="setActiveTab('staff')" i18n>
            ูพุฑุณูู
          </button>
          <button type="button" [class.active]="activeTab === 'info'" (click)="setActiveTab('info')" i18n>
            ุงุทูุงุนุงุช ุณุงูู
          </button>
          <button type="button" [class.active]="activeTab === 'reviews'" (click)="setActiveTab('reviews')" i18n>
            ูุธุฑุงุช
          </button>
        </div>

        <div class="tab-content" [class.active]="activeTab === 'about'">
          <div>
            <p *ngIf="detail.description; else noDescription">{{ detail.description }}</p>
            <ng-template #noDescription>
              <p i18n>ุชูุถุญ ุจุฑุง ุงู ุณุงูู ุซุจุช ูุดุฏู ุงุณุช.</p>
            </ng-template>
          </div>
          <div class="achievements" *ngIf="detail.achievementDtos?.length; else noAchievements">
            <h3 i18n>ุฏุณุชุงูุฑุฏูุง</h3>
            <div class="tags">
              <span
                class="tag"
                [ngClass]="getAchievementColor(i)"
                *ngFor="let achievement of detail.achievementDtos; index as i; trackBy: trackByAchievement"
              >
                {{ achievement.name }}
              </span>
            </div>
          </div>
          <ng-template #noAchievements>
            <div class="achievements empty">
              <h3 i18n>ุฏุณุชุงูุฑุฏูุง</h3>
              <p i18n>ุฏุณุชุงูุฑุฏ ุจุฑุง ุงู ุณุงูู ุซุจุช ูุดุฏู ุงุณุช.</p>
            </div>
          </ng-template>
        </div>

        <div class="tab-content" [class.active]="activeTab === 'staff'">
          <div>
            <p i18n>
              ุจุฑูุงููโูุง ูุนุงู ุงู ุณุงูู ุฏุฑ {{ detail.businessOwnerDayDtos.length | number: '1.0-0' }} ุฑูุฒ ููุชู ุซุจุช ุดุฏู ุงุณุช.
            </p>
            <p *ngIf="detail.businessOwnerDayDtos.length === 0" i18n>ูููุฒ ุจุฑูุงููโุง ุจุฑุง ุงู ุณุงูู ุซุจุช ูุดุฏู ุงุณุช.</p>
          </div>
          <div class="services" *ngIf="detail.businessServiceDtos?.length">
            <h3 i18n>ุฎุฏูุงุช ุงุฑุงุฆู ุดุฏู</h3>
            <ul>
              <li *ngFor="let service of detail.businessServiceDtos; trackBy: trackByService">
                <span>{{ service.serviceName }}</span>
                <span>{{ formatCurrency(service.amount) }}</span>
              </li>
            </ul>
          </div>
        </div>

        <div class="tab-content" [class.active]="activeTab === 'info'">
          <div>
            <p i18n>๐ ุขุฏุฑุณ: {{ detail.cityName }}ุ {{ detail.regionName }}ุ {{ detail.neighberhoodName }}</p>
            <p *ngIf="hasWorkingHours(detail.businessOwnerDayDtos); else noSchedule" i18n>๐ ุณุงุนุช ฺฉุงุฑ:</p>
            <ul class="schedule" *ngIf="hasWorkingHours(detail.businessOwnerDayDtos)">
              <li *ngFor="let day of detail.businessOwnerDayDtos; trackBy: trackByDay">
                <span>{{ getDayName(day.dayOfWeek) }}</span>
                <span>{{ getWorkingHours(day) }}</span>
              </li>
            </ul>
            <ng-template #noSchedule>
              <p i18n>๐ ุณุงุนุช ฺฉุงุฑ ุซุจุช ูุดุฏู ุงุณุช.</p>
            </ng-template>
          </div>
        </div>

        <div class="tab-content" [class.active]="activeTab === 'reviews'">
          <div *ngIf="detail.commentDtos?.length; else noComments">
            <div class="review" *ngFor="let comment of detail.commentDtos; trackBy: trackByComment">
              <p class="review-author">
                {{ comment.userFullName }}
                <ng-container *ngIf="!comment.userFullName">
                  <span i18n>ูุดุชุฑ</span>
                </ng-container>
              </p>
              <p class="review-text">{{ getCommentText(comment) }}</p>
            </div>
          </div>
          <ng-template #noComments>
            <p i18n>ูููุฒ ูุธุฑ ุจุฑุง ุงู ุณุงูู ุซุจุช ูุดุฏู ุงุณุช.</p>
          </ng-template>

          <form class="review-form" [formGroup]="reviewForm" (ngSubmit)="submitReview()" novalidate>
            <h3 i18n>ุซุจุช ูุธุฑ ู ุงูุชุงุฒ</h3>
            <label for="reviewRate" i18n>ุงูุชุงุฒ ุดูุง</label>
            <select id="reviewRate" formControlName="rate">
              <option *ngFor="let rate of [5,4,3,2,1]" [ngValue]="rate">{{ rate }}</option>
            </select>
            <label for="reviewComment" i18n>ูุชู ูุธุฑ</label>
            <textarea
              id="reviewComment"
              formControlName="comment"
              rows="3"
              placeholder="ูุธุฑ ุฎูุฏ ุฑุง ุฏุฑุจุงุฑู ฺฉูุช ุฎุฏูุงุช ุจููุณุฏ"
              i18n-placeholder
            ></textarea>
            <div
              class="form-feedback"
              *ngIf="
                reviewForm.invalid &&
                (reviewForm.get('comment')?.touched || reviewForm.get('rate')?.touched)
              "
              i18n
            >
              ูุทูุงู ูุฑ ุฏู ููุฏ ุงูุชุงุฒ ู ูุชู ูุธุฑ ุฑุง ุชฺฉูู ฺฉูุฏ.
            </div>
            <button class="btn btn--primary" type="submit" [disabled]="isSubmittingReview" i18n>ุงุฑุณุงู ูุธุฑ</button>
            <p *ngIf="reviewFeedback" [class.success]="reviewFeedbackType==='success'" [class.error]="reviewFeedbackType==='error'">
              {{ reviewFeedback }}
            </p>
          </form>
        </div>
      </div>
    </div>
  </ng-container>
</div>
